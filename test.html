<!DOCTYPE html>
<html>
<head>
<title>slamstr</title>

<link href="examples/content/shared/styles/examples-offline.css"
    rel="stylesheet">
<link href="styles/kendo.common.min.css" rel="stylesheet">

<script src="js/kendo.all.min.js" type="text/javascript"></script>
<link href="bbb.css" rel="stylesheet">

<script src="js/jquery.min.js" type="text/javascript"></script>
<script src="js/kendo.web.min.js" type="text/javascript"></script>
<script src="examples/content/shared/js/console.js"
    type="text/javascript"></script>
<script src="bbb.js" type="text/javascript"></script>

<script src="examples/content/shared/js/people.js"></script>

<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript">
      google.load('visualization', '1', {packages: ['corechart']});
    </script>




</head>
<body>


<body>
  <div id="page-wrapper">

    <h1>Text File Reader</h1>
    <div>
      Select a text file: 
      <input type="file" id="fileInput">
    </div>
    <pre id="fileDisplayArea"></pre>

  </div>

  <script>




        var fileInput = document.getElementById('fileInput');
        var fileDisplayArea = document.getElementById('fileDisplayArea');

        fileInput.addEventListener('change', function(e) {
            var file = fileInput.files[0];
            var textType = /text.*/;

            if (file.type.match(textType)) {
                var reader = new FileReader();

                reader.onload = function(e) {

                    lines = (reader.result).split(/\r?\n/);
                    
                    sqlStr1 ="test";
                    sqlStr2 ="test";
                  //  for(var i = 0; i < lines.length; i++){


var i = 0;                     //  set your counter to 1

function myLoop () {           //  create a loop function
   setTimeout(function () {    //  call a 3s setTimeout when the loop is called
  

                        fileID = lines[i].split(",");
                        numID = parseInt(fileID[0]);
                        status = 0;
                        if (numID%2 == 0){
                            status = 0;
                        }else{
                            status = 1;
                        }


                      sqlStr1 = lines[i];
                      sqlStr2 = ""+numID+",0,"+status+",0";

                      //fileDisplayArea.innerText = sqlStr1 + " " +sqlStr2;

                      $.ajax({ 
                            url: '/addToDB',
                            type: 'POST',
                            cache: false, 
                            data: { 'sqlString1':sqlStr1, 'sqlString2':sqlStr2 }, 
                            success: function(data){

                               fileDisplayArea.innerText = sqlStr1 + " " +sqlStr2;
                                
                                
                            }
                            , error: function(jqXHR, textStatus, err){
                                //alert('text status '+textStatus+', err '+err)
                            }
                         });



              
      i++;                     //  increment the counter
      if (i < lines.length) {            //  if the counter < 10, call the loop function
         myLoop();             //  ..  again which will trigger another 
      }                        //  ..  setTimeout()





                     
                      

   }, 1000)
}

myLoop(); 



                }

                reader.readAsText(file);    
            } else {
                fileDisplayArea.innerText = "File not supported!"
            }
        });





  </script>
</body>
</html>
